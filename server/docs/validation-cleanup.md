# –û—Ç—á–µ—Ç –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ –¥—É–±–ª–∏—Ä—É—é—â–µ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2026-02-12  
**–¶–µ–ª—å:** –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ middleware

---

## ‚úÖ –£–¥–∞–ª–µ–Ω–Ω–∞—è –¥—É–±–ª–∏—Ä—É—é—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 1. `loginUserController.js`

**–£–¥–∞–ª–µ–Ω–æ:**
```javascript
// –ë–´–õ–û:
if (!email || !password) {
    return errorRes(res, 400, '–£–∫–∞–∂–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å');
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ middleware `loginUserValidation`:
- `email` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email
- `password` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã (6 —Å–∏–º–≤–æ–ª–æ–≤)

---

### 2. `authTelegramController.js`

**–£–¥–∞–ª–µ–Ω–æ:**
```javascript
// –ë–´–õ–û:
if (!telegramUserId) {
    return errorRes(res, 400, '–£–∫–∞–∂–∏—Ç–µ telegramUserId');
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ middleware `telegramAuthValidation`:
- `telegramUserId` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–µ–ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

---

### 3. `userVoteRatingController.js`

**–£–¥–∞–ª–µ–Ω–æ:**
```javascript
// –ë–´–õ–û:
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
if (!userVoteTargetIdClient || userVoteValueClient == null || !userVoterIdClient) {
    return errorRes(res, 400, '–ù–µ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã');
}

// –û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 10
const userVoteValue = Math.round(Number(userVoteValueClient));
if (Number.isNaN(userVoteValue) || userVoteValue < 1 || userVoteValue > 10) {
    return errorRes(res, 400, '–û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 10');
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ middleware:
- `voteTargetIdParamValidation` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `userVoteTargetIdClient` (ObjectId —Ñ–æ—Ä–º–∞—Ç)
- `voteValidation` - –ø—Ä–æ–≤–µ—Ä–∫–∞ `userVoteValueClient` (—á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10)
- `userVoterIdClient` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `checkAuthMW` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –¥–æ—à–µ–ª –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞)

**–û—Å—Ç–∞–≤–ª–µ–Ω–æ (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –Ω–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è):**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ —Å–µ–±—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç –≥–æ–ª–æ—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### 4. `userUpdateProfileController.js`

**–£–¥–∞–ª–µ–Ω–æ:** –í—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤, —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 108-187)

**–£–¥–∞–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã (`userBirthDate`)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç—ã (–Ω–µ –≤ –±—É–¥—É—â–µ–º)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è enum –∑–Ω–∞—á–µ–Ω–∏–π (`userGender`, `userRole`)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —á–∏—Å–µ–ª (`userDiscountPercent` 0-100)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ URL (`userAvatarUrl`, `userBackgroundUrl`)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫ (`userName` –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Å—Ç—Ä–æ–∫–∏ (`userPhoneNumber`)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ boolean (–±—É–ª–µ–≤—ã –ø–æ–ª—è)

**–ü—Ä–∏—á–∏–Ω–∞:** –í—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ middleware `updateProfileValidation`:
- –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö
- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –î–∏–∞–ø–∞–∑–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π
- Enum –∑–Ω–∞—á–µ–Ω–∏—è
- –î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫

**–û—Å—Ç–∞–≤–ª–µ–Ω–æ (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞):**
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–∏ –≤ Date –¥–ª—è `userBirthDate`
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Number –¥–ª—è `userDiscountPercent`
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `trim()` –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π `updateData`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ `userName` –∏ `userPhoneNumber`

---

## üîß –£–ª—É—á—à–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### `updateProfileValidation.js`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `null` –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª–µ–π

```javascript
.optional({ nullable: true, checkFalsy: true })
.custom((value) => {
    if (value === null || value === '') {
        return true; // –†–∞–∑—Ä–µ—à–∞–µ–º null –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
    }
    // –≤–∞–ª–∏–¥–∞—Ü–∏—è...
})
```

**–ü–æ–ª—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π null:**
- `userName` - –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å null)
- `userBirthDate` - –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å
- `userPhoneNumber` - –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å
- `userAvatarUrl` - –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å
- `userBackgroundUrl` - –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å
- `userAddress` - –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å
- `notesAboutUser` - –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ—á–∏—Å—Ç–∫–∏:
- **–î—É–±–ª–∏—Ä—É—é—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:** –í 4 –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** ~150 —Å—Ç—Ä–æ–∫
- **–ü—Ä–æ–±–ª–µ–º—ã:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –¥–≤–∞–∂–¥—ã (–≤ middleware –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ)

### –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:
- **–î—É–±–ª–∏—Ä—É—é—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:** –£–¥–∞–ª–µ–Ω–∞
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** ~50 —Å—Ç—Ä–æ–∫ (—Ç–æ–ª—å–∫–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ middleware

---

## ‚úÖ –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–Ω–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è):
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–∞–∫–∏–º email/userName/phoneNumber
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ owner/admin –ø—Ä–∞–≤
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª** - –∑–∞–ø—Ä–µ—Ç –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ —Å–µ–±—è

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ (–Ω–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è):
1. **Date –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** - `new Date(value)` –¥–ª—è `userBirthDate`
2. **Number –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** - `Number(value)` –¥–ª—è `userDiscountPercent`
3. **String trim** - `value.trim()` –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞):
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π updateData** - –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –µ—Å—Ç—å —á—Ç–æ –æ–±–Ω–æ–≤–ª—è—Ç—å
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ userId –∏–∑ —Ç–æ–∫–µ–Ω–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω (—É–∂–µ –≤ middleware)

---

## üìù –ò—Ç–æ–≥

‚úÖ **–í—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤, —Ç–∏–ø–æ–≤ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ middleware**  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é —Ç–∏–ø–æ–≤**  
‚úÖ **–ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ –∏ –ø—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å**  
‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏**  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ null –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª–µ–π**

---

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `server/controllers/loginUserController.js`
- `server/controllers/authTelegramController.js`
- `server/controllers/userVoteRatingController.js`
- `server/validations/updateProfileValidation.js` (—É–ª—É—á—à–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ null)
